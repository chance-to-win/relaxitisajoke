<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Prank Video</title>
  <style>
    :root { --bg:#1f2937; --cta:#2563eb; }
    html, body { margin:0; padding:0; height:100%; background:#000; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    .wrap { position:fixed; inset:0; }
    #overlay {
      position:absolute; inset:0; z-index:3;
      background: var(--bg) center/cover no-repeat;
      display:grid; place-items:center;
      transition: opacity .28s ease;
    }
    .ctaBtn {
      padding: 20px 44px;
      border:none; border-radius:999px;
      font-size: 22px; font-weight:600;
      background:var(--cta); color:#fff;
      box-shadow: 0 8px 20px rgba(0,0,0,.3);
      cursor:pointer;
      transition: background .2s ease, transform .1s ease;
    }
    .ctaBtn:active { transform: scale(.96); }
    #vid {
      position:absolute; inset:0; z-index:1;
      width:100vw; height:100vh; object-fit:cover; background:#000;
      opacity:0; transition: opacity .28s ease;
    }
    #vid.visible { opacity:1; }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="overlay">
      <button id="startBtn" class="ctaBtn">â–¶ Start</button>
    </div>

    <video id="vid"
      src="./video/video.mp4"
      playsinline
      webkit-playsinline
      preload="metadata"
      muted
      poster="./video/poster.jpg"
    ></video>
  </div>

  <script>
    const vid = document.getElementById('vid');
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');
    const REMOTE_LOG_URL = "https://blue-dawn-50e0.ignatius-b-dick.workers.dev/log";


    // Step 1: Start button
    startBtn.addEventListener('click', async () => {
      try {
        vid.muted = true;          // required for autoplay on mobile
        await vid.play();
        vid.classList.add('visible');
        // change button into "Ladda om"
        startBtn.textContent = "ðŸ”„ Ladda om";
        // move into "reload mode"
        startBtn.onclick = reloadMode;
      } catch (e) {
        console.error("Playback blocked", e);
      }
    });

    // Step 2: Fake reload button
    function reloadMode() {
      // Unmute instead of reloading
      vid.muted = false;
      startBtn.textContent = "âœ… Klar";
      // fade away overlay after a short delay
      setTimeout(()=> {
        overlay.style.opacity = '0';
        setTimeout(()=> overlay.style.display='none', 300);
      }, 600);
    }

    let sent = false;

  function logView(videoId="promo_v1"){
    const payload = { videoId, ts:new Date().toISOString(), ua:navigator.userAgent };
    if (navigator.sendBeacon) {
      navigator.sendBeacon(REMOTE_LOG_URL, new Blob([JSON.stringify(payload)], { type:'application/json' }));
    } else {
      fetch(REMOTE_LOG_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
        .catch(()=>{});
    }
  }

  vid.addEventListener('playing', () => {
    if (!sent) { sent = true; logView(); }
  });
  </script>
</body>
</html>
